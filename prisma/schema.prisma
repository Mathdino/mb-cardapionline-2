generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["driverAdapters"]
}

datasource db {
  provider = "postgresql"
}

model Company {
  id                     String      @id @default(uuid())
  name                   String
  slug                   String      @unique
  description            String
  profileImage           String
  bannerImage            String
  phone                  String[]
  whatsapp               String
  minimumOrder           Float
  address                Json
  businessHours          Json
  paymentMethods         String[]
  isOpen                 Boolean     @default(true)
  createdAt              DateTime    @default(now())
  updatedAt              DateTime    @updatedAt
  facebook               String?
  instagram              String?
  allowsDelivery         Boolean     @default(true)
  allowsPickup           Boolean     @default(true)
  categories             Category[]
  coupons                Coupon[]
  orders                 Order[]
  products               Product[]
  promotions             Promotion[]
  users                  User[]
}

model Coupon {
  id             String    @id @default(uuid())
  companyId      String
  code           String
  type           String
  value          Float
  minOrderValue  Float?
  maxDiscount    Float?
  startDate      DateTime?
  expirationDate DateTime?
  usageLimit     Int?
  usageCount     Int       @default(0)
  isActive       Boolean   @default(true)
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt
  company        Company   @relation(fields: [companyId], references: [id])
  orders         Order[]

  @@unique([companyId, code])
}

model User {
  id            String    @id @default(uuid())
  email         String?   @unique
  password      String?
  name          String?
  role          String    @default("customer")
  companyId     String?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  address       Json?
  cpf           String?   @unique
  emailVerified DateTime?
  image         String?
  phone         String?
  accounts      Account[]
  orders        Order[]
  sessions      Session[]
  company       Company?  @relation(fields: [companyId], references: [id])
}

model Account {
  id                String  @id @default(cuid())
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String?
  access_token      String?
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String?
  session_state     String?
  user              User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
}

model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
}

model Category {
  id        String    @id @default(uuid())
  companyId String
  name      String
  order     Int
  company   Company   @relation(fields: [companyId], references: [id])
  products  Product[]
}

model Product {
  id                   String      @id @default(uuid())
  companyId            String
  categoryId           String
  name                 String
  description          String
  image                String
  price                Float
  promotionalPrice     Float?
  isPromotion          Boolean     @default(false)
  productType          String
  flavors              Json?
  comboConfig          Json?
  isAvailable          Boolean     @default(true)
  ingredients          String[]
  complements          Json?
  wholesaleMinQuantity Int?
  wholesalePrice       Float?
  preparationTime      Int         @default(0)
  preparationTimeUnit  String      @default("hours")
  category             Category    @relation(fields: [categoryId], references: [id])
  company              Company     @relation(fields: [companyId], references: [id])
  promotions           Promotion[]
}

model Promotion {
  id               String   @id @default(uuid())
  companyId        String
  productId        String
  promotionalPrice Float
  startDate        DateTime
  endDate          DateTime
  isActive         Boolean  @default(true)
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
  company          Company  @relation(fields: [companyId], references: [id])
  product          Product  @relation(fields: [productId], references: [id])
}

model Order {
  id                  String    @id @default(uuid())
  companyId           String
  customerName        String
  customerPhone       String
  items               Json
  total               Float
  status              String
  paymentMethod       String
  notes               String?
  createdAt           DateTime  @default(now())
  couponId            String?
  customerCpf         String?
  deliveryAddress     Json?
  discount            Float?
  userId              String?
  scheduledPickupTime DateTime?
  company             Company   @relation(fields: [companyId], references: [id])
  coupon              Coupon?   @relation(fields: [couponId], references: [id])
  user                User?     @relation(fields: [userId], references: [id])
}
